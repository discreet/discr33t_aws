require 'aws-sdk'

dynamodb_client = Aws::DynamoDB::Client.new(
  access_key_id: '<%= @aws_access_key %>',
  secret_access_key: '<%= @aws_secret_key %>',
  region: '<%= @aws_region %>'
)

exists = dynamodb_client.list_tables ()

unless exists.table_names.include?('Discr33tRestricted')
  dynamodb_client.create_table(
    {
      attribute_definitions:
        [
          {
	    attribute_name: "KeySchemaAttributeName",
	    attribute_type: "S",
	  },
        ],
      table_name: "Discr33tRestricted",
      key_schema: [
        {
	  attribute_name: "KeySchemaAttributeName",
          key_type: "HASH",
        },
      ],
      provisioned_throughput: {
        read_capacity_units: 1,
        write_capacity_units: 1,
      },
    }
  )
  dynamodb_client.wait_until(:table_exists, table_name: 'Discr33tRestricted')
end
